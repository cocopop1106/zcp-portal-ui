<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" layout:decorator="layout/template-default">
<head>
	<title>CloudZ CP</title>
	<meta charset="UTF-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<script th:inline="javascript" type="text/javascript">
	/*<![CDATA[*/
		function initNamespace(namespace){
			var url = "/management/namespace/getNamespaceResource";
			ajaxCall(url, {"namespace" : namespace}).done(function(data){
				if(data.resourceQuota){
					$('#input_cpu_requests').val(data.resourceQuota.status.hard["requests.cpu"]);
					$('#input_cpu_limits').val(data.resourceQuota.status.hard["limits.memory"]);
					$('#input_memory_requests').val(data.resourceQuota.status.hard["requests.cpu"]);
					$('#input_memory_limits').val(data.resourceQuota.status.hard["limits.memory"]);
					$('#input_pods').val(data.resourceQuota.status.hard.pods);
					$('#input_services').val(data.resourceQuota.status.hard.services);
					$('#input_secrets').val(data.resourceQuota.status.hard.secrets);
					$('#input_config_maps').val(data.resourceQuota.status.hard.configmaps);
					$('#input_pesistent_volumne').val(data.resourceQuota.status.hard.persistentvolumeclaims);
					$('#input_service_load').val(data.resourceQuota.status.hard["services.loadbalancers"]);
				}
				if(data.limitRange){
					$('#input_pod_cpu_requests').val(	data.limitRange.spec.limits[0].defaultRequest.cpu.number);
					$('#input_pod_cpu_limits').val(		data.limitRange.spec.limits[0].default.cpu.number);
					$('#input_pod_memory_requests').val(data.limitRange.spec.limits[0].defaultRequest.memory.number);
					$('#input_pod_memory_limits').val(	data.limitRange.spec.limits[0].default.memory.number);
				}
				if(data.namespace){
					$('#input_namespace').val(data.namespace)
				}
			});
			
		}
	
		function ajaxCall(url, data){
			return $.ajax({
				method: 'post',
				contentType : 'application/json;charset=UTF-8',
				url: url,
				data: JSON.stringify(data)
	        }).fail(function(jqXHR, textStatus, errorThrown) {
	        	console.log(jqXHR);
	            //alert('처리 중 오류가 발생하였습니다. 잠시 후 다시 시도하세요.');
	        });
		}
		
		$(document).ready(function(){
			var namespace = /*[[${namespace}]]*/;
			var status = /*[[${param.status}]]*/;
			if(namespace){
				$('#input_namespace').val(namespace);
				initNamespace(namespace);
				$('#span_namespace').text(namespace);
				if('inactive' == status)
					$('.active').removeClass('active').addClass('inactive');
			}
			
		});
		
		function addNamespace(){
			function getCpu(id){
				var v = $('#'+id + " :selected" ).val();
				if(v == 'm') return "m";
				return "";
			}
			function getMemory(id){
				var v = $('#'+id + " :selected" ).val();
				if(v == 'Gi') return "Gi";
				return "";
			}
			
			if(!validate()) return ;
			
			var data={
				resourceQuota : {
					spec :{
						hard : {
							"requests.cpu" : $('#input_cpu_requests').val() + ''
							,"limits.cpu" : $('#input_cpu_limits').val() + ''
							,"requests.memory" : $('#input_memory_requests').val() + ''
							,"limits.memory" : $('#input_memory_limits').val() + ''
							,"pods" : $('#input_pods').val() ? $('#input_pods').val() + '': "0" 
							,"services" : $('#input_services').val() ? $('#input_services').val() + '': "0"
							,"secrets" : $('#input_secrets').val() ? $('#input_secrets').val()+ '' : "0"
							,"configmaps" : $('#input_config_maps').val() ? $('#input_config_maps').val()+ '' : "0"
							,"persistentvolumeclaims" : $('#input_persistent_volume').val() ? $('#input_persistent_volume').val()+ '' : "0"
							,"services.loadbalancers" : $('#input_persistent_service_load').val() ? $('#input_persistent_service_load').val()+ '' : "0"
						}
					}
				},
				limitRange : {
					spec : {
						limits : [{
							defaultRequest : {
								cpu : $('#input_pod_cpu_requests').val()
								,memory :  $('#input_pod_memory_requests').val()
							},
							default : {
								cpu :  $('#input_pod_cpu_limits').val()
								,memory : $('#input_pod_memory_limits').val()
							},
							type: "Container"
						}]
					}
				},
				namespace :  /*[[${namespace}]]*/
			};
			var url = "/management/namespace/createAndEdit";
			
			ajaxCall(url, data).done(function(data){
				alert('정상처리되었습니다.');
				location.href='/management/namespaces';
			});
		}
		
		function validate(){
			var regex_namespace = /^[a-zA-Z][0-9a-zA-z\-]{5,11}$/;
			if(!regex_namespace.test($('#input_namespace').val())){
				alert('허용하지 않는 문자입니다.');
				return false;
			}
			if(!$('#input_cpu_requests').val()) {
				$('#input_cpu_requests').focus();
				alert('필수값 입니다.');
				return false;
			}
			if(!$('#input_cpu_limits').val()) return false;
			if(!$('#input_memory_requests').val()) return false;
			if(!$('#input_memory_limits').val()) return false;
			if(!$('#input_pod_cpu_requests').val()) return false;
			if(!$('#input_pod_cpu_limits').val()) return false;
			if(!$('#input_pod_memory_requests').val()) return false;
			if(!$('#input_pod_memory_limits').val()) return false;
			return true;
		}
		
		
	 /*]]>*/
    </script>
</head>
<body>
<div class="cp-wrapper">
	<th:block layout:fragment="content">
	<!-- main-contents -->
	<div class="cp-container">
		<!-- contents -->
		<div class="contents-wrap">
			<!-- location -->
			<div class="locations-area">
				<div class="back-list"><a href="/management/namespaces"><span>목록으로 돌아가기</span></a></div>
			</div>
			<div class="contents-box">
				<!-- service top area-->
				<div class="top-area">
                    <dl class="service-info">
            			<dt><span id="span_namespace"></span>
            				<span class="state active"></span>
            				<p class="Tooltip" data-position="right">Active</p>
            			</dt>
            			<dd class="service-user">
            				<strong>생성일시</strong> : <span>2018-06-01 00:33:55</span>
            			</dd>
            		</dl>
            		<div class="btn-wrap__right">
	                    <button class="Button btn-ico__typeb btn-godash">Dashoboard 보기</button>
	                    <button class="Button btn-ico__typeb btn-config">삭제</button>
	                </div>
				</div>
				<!-- tab wrap -->
				<div class="Tabs Fixed" data-tab-width="180px">
				    <ul>
				        <li data-content="#tab1">Resource 구성</li>
				        <li data-content="#tab2">멤버관리</li>
				    </ul>
				    <!-- Resource 구성 -->
				    <div id="tab1">
				    	<p class="intab-txt">Namespace의 Resource 구성정보를 조회 및 변경합니다.<a href="#" class="view-detail">자세히 보기</a></p>
					    <!-- accordion -->
					    <!-- namespace name detail data-->
						<div class="lay-item__box">
							<!-- left table-->
							<div class="lay-item__left">
								<h3 class="form-title">Resource Quotas</h3>
								<form>
									<fieldset>
										<table class="Table Form-type tbl-name">
											<colgroup>
												<col style="width: 180px;"/>
												<col/>
											</colgroup>
											<tbody>
												<tr>
													<th>CPU Requests</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_cpu_requests"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typea" data-default="40"></div>
															</div>
															<span class="name-pro__num">40%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>CPU Limits</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_cpu_limits"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typeb" data-default="50"></div>
															</div>
															<span class="name-pro__num">50%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Memory Requests</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_memory_requests"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typec" data-default="50"></div>
															</div>
															<span class="name-pro__num">50%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Memory Limits</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_memory_limits"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typed" data-default="25"></div>
															</div>
															<span class="name-pro__num">25%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Pods</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput" id="input_pods"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typea" data-default="70"></div>
															</div>
															<span class="name-pro__num">70%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Services</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput"  id="input_services"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typee" data-default="20"></div>
															</div>
															<span class="name-pro__num">20%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Secrets</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput" id="input_secrets"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typea" data-default="100"></div>
															</div>
															<span class="name-pro__num">100%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Config Maps</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput" id="input_config_maps"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typec" data-default="10"></div>
															</div>
															<span class="name-pro__num">10%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Persistent Volumne<br/>Claims</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput" id="input_pesistent_volumne"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typed" data-default="66"></div>
															</div>
															<span class="name-pro__num">66%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Services Load<br/>Balancers</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left">
																<input class="Textinput"  id="input_service_load"/><span class="num-txt">개</span>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typee" data-default="80"></div>
															</div>
															<span class="name-pro__num">80%</span>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
									</fieldset>
								</form>
							</div>
							<!--right table-->
							<div class="lay-item__right">
								<h3 class="form-title">Pod Default Limit Range</h3>
								<form>
									<fieldset>
										<table class="Table Form-type tbl-name">
											<colgroup>
												<col style="width: 180px;"/>
												<col/>
											</colgroup>
											<tbody>
												<tr>
													<th>CPU Requests</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_pod_cpu_requests"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typea" data-default="40"></div>
															</div>
															<span class="name-pro__num">40%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>CPU Limits</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_pod_cpu_limits"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typeb" data-default="50"></div>
															</div>
															<span class="name-pro__num">50%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th>Memory Requests</th>
													<td>
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_pod_memory_requests"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typec" data-default="50"></div>
															</div>
															<span class="name-pro__num">50%</span>
														</div>
													</td>
												</tr>
												<tr>
													<th class="Valign-top" style="height: 420px;">Memory Limits</th>
													<td class="Valign-top">
														<div class="tbl-group__wrap">
															<div class="left"><input class="Textinput" id="input_pod_memory_limits"/></div>
															<div class="left">
																<div class="Divselect">
																    <select>
																        <option value="k">CPU(core)</option>
												        				<option value="m">m(core)</option>
																    </select>
																    <span></span>
																</div>
															</div>
															<div class="name-pro__wrap">
																<div class="Progressbar name-typed" data-default="25"></div>
															</div>
															<span class="name-pro__num">25%</span>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
									</fieldset>
								</form>
							</div>
						</div>
						<!-- button wrap-->
						<div class="btn-wrap">
							<div class="btn-left"><button class="Button btn">취소</button></div>
							<div class="btn-right"><button class="Button btn bg-red"  onclick="addNamespace();">저장</button></div>
						</div>
					</div>
				    <!-- 멤버관리 -->
				    <div id="tab2">
				    	<p class="intab-txt">Namespace 멤버 권한 정보를 관리합니다.</p>
			    		<!-- search-wrap-->
						<div class="search-wrap">
							<input class="Textinput srcinput" placeholder="검색어를 입력하세요."/><button class="Button btn-search">검색</button>
						</div>
						<h3 class="form-title">멤버</h3>
		            	<div id="gr3"></div>
						<div class="btn-wrap">
							<div class="btn-left"><button class="Button btn">멤버추가</button></div>
							<div class="btn-right"><button class="Button btn bg-red">저장</button></div>
						</div>
				    </div>
				</div>
			</div>
		</div>
		<!-- //contents -->
	</div>
	<!-- //main-contents -->
	</th:block>
</div>
</body>
</html>

