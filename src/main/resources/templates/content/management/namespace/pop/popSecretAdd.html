<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<script type="text/javascript">
	$.alopex.page(function() {
		this.init = function(id, param) {
			zcpPopSecretApp.pageInit();
		};
	});

	var zcpPopSecretApp = {
		pageInit : function() {
			'use strict';
			this.data.init();
			this.event.init();
		},
		data : {
			init : function() {
			},
			updateChannel : function() {
				if (!this.validation()) {
					return false;
				}

				/* $a.request('/alert/updateChannel', {
					method : 'post',
					data : $('#popForm').serializeObject(),
					success : function(res) {
						if (res.resultCd !== '200') {
							if (res.resultMsg)
								alert(res.resultMsg);
							return false;
						} else {
							$a.close('ok');
						}
					},
					error : function(errObject) {
						alert('처리 중 오류가 발생하였습니다. 잠시 후 다시 시도하세요.');
					}
				}); */

			},
			validation : function() {
				var pDivision = $("#pDivision option:selected").val();

				if (pDivision == 'dr') {
					$('#pSlack_msg').text('');
					var pUrl_valid = isValidURL($('#pSlack_api_url').val());
					var pSlack_api_url = $('#pSlack_api_url').validate();

					if (!pSlack_api_url) {
						$('#pSlack_api_url').effect('shake');
						return false;
					} else if (!pUrl_valid) {
						$('#pSlack_msg').css('display', '');
						$('#pSlack_msg').text('유효한 URL을 입력해주세요.');
						$('#pSlack_api_url').effect('shake');
						return false;
					} else {
						$('#pSlack_msg').css('display', 'none');
						$('#pSlack_msg').text('');
						return true;
					}
				} else if (pDivision == 'tls') {
					$('#pHipchat_msg').text('');
					var pUrl_valid = isValidURL($('#pHipchat_api_url').val());
					var pHipchat_api_url = $('#pHipchat_api_url').validate();
					var pHipchat_room_id = $('#pHipchat_room_id').validate();
					var pHipchat_auth_token = $('#pHipchat_auth_token')
							.validate();

					if (!pHipchat_api_url || !pHipchat_room_id
							|| !pHipchat_auth_token) {
						if (!pHipchat_api_url) {
							$('#pHipchat_api_url').effect('shake');
						} else if (!pUrl_valid) {
							$('#pHipchat_msg').css('display', '');
							$('#pHipchat_msg').text('유효한 URL을 입력해주세요.');
							$('#pHipchat_api_url').effect('shake');
						}
						if (!pHipchat_room_id) {
							$('#pHipchat_room_id').effect('shake');
						}
						if (!pHipchat_auth_token) {
							$('#pHipchat_auth_token').effect('shake');
						}
						return false;
					} else {
						$('#pHipchat_msg').css('display', 'none');
						$('#pHipchat_msg').text('');
						return true;
					}
				}
			}
		},
		event : {
			init : function() {
				$a.keyfilter.addKeyUpRegexpRule("email", "a-zA-Z0-9@.;_-");

				$('#popCancel').on('click', function() {
					$a.close('cancel');
				});
				$('#popOk').on('click', function() {
					//zcpPopSecretApp.data.updateChannel();
				});
				$('#pDivision').change(function() {
					var divisionVal = $("#pDivision option:selected").val();

					if (divisionVal == 'dr') {
						$('#pDrDiv').css('display', '');
						$('#pTLSDiv').css('display', 'none');
						$('.af-dialog').attr('style', 'position: fixed;z-index: 1001;opacity: 1;overflow: hidden;display: block;height: 590px;width: 590px; top: 50%; left: 50%; transform:translate(-50%, -50%);');
					} else if (divisionVal == 'tls') {
						$('#pDrDiv').css('display', 'none');
						$('#pTLSDiv').css('display', '');
						$('.af-dialog').attr('style', 'position: fixed;z-index: 1001;opacity: 1;overflow: hidden;display: block;height: 480px;width: 590px; top: 50%; left: 50%; transform:translate(-50%, -50%);');
						
					}
				});
			}
		}
	}
</script>
</head>
<body>
	<div class="popup-wrap">
		<div class="popup-contents"
			style="background: #ffffff; height: 200px;">
			<div class="popup-text" id="popMessage">
				<fieldset>
					<form th:id="popForm" onsubmit="return false;">
						<table class="Table Form-type">
							<colgroup>
								<col style="width: 180px;" />
								<col />
							</colgroup>
							<tbody>
								<tr>
									<th style="text-align: left; padding-left: 20px">Secret
										Name</th>
									<td><input class="Textinput Width-100"
										th:id="pSecret_name" th:name="pSecret_name"
										maxlength="100" data-validation-rule="{required:true}"
										data-validation-message="{required:'Secret Name을 입력해주세요.'}" />
										<p id="pSecret_name_msg" class="info-text"
											data-for="pSecret_name"></p></td>
								</tr>
								<tr>
									<th style="text-align: left; padding-left: 20px">Secret
										Type</th>
									<td>
										<div class="Divselect"
											style="width: 100%; padding: 0px 18px 0px 10px;">
											<select th:id="pDivision">
												<option value="dr">Docker Registry</option>
												<option value="tls">TLS</option>
											</select> <span id="pSelect"></span>
										</div>
									</td>
								</tr>
								<tr>
									<th style="text-align: left; padding-left: 20px">Label</th>
									<td><input class="Textinput Width-100"
										th:id="pLabel" th:name="pLabel"
										maxlength="100" data-validation-rule="{required:true}"
										data-validation-message="{required:'Label을 입력해주세요.'}" />
										<p id="pLabel_msg" class="info-text"
											data-for="pLabel"></p></td>
								</tr>
							</tbody>
						</table>
						<div id="pDrDiv">
							<fieldset>
								<table class="Table Form-type channel-line">
									<colgroup>
										<col style="width: 180px;" />
										<col />
									</colgroup>
									<tbody>
										<tr>
											<th>docker-server</th>
											<td><input class="Textinput Width-100"
												th:id="pHipchat_api_url" th:name="pHipchat_api_url"
												maxlength="100" data-validation-rule="{required:true}"
												data-validation-message="{required:'docker-server를 입력해주세요.'}" />
												<p id="pHipchat_msg" class="info-text"
													data-for="pHipchat_api_url"></p></td>
										</tr>
										<tr>
											<th>docker-username</th>
											<td><input class="Textinput Width-100"
												th:id="pHipchat_room_id" th:name="pHipchat_room_id"
												maxlength="100" data-validation-rule="{required:true}"
												data-validation-message="{required:'docker-username을 입력해주세요.'}" />
												<p class="info-text" data-for="pHipchat_room_id"></p></td>
										</tr>
										<tr>
											<th>docker-password</th>
											<td><input class="Textinput Width-100"
												th:id="pHipchat_auth_token" th:name="pHipchat_auth_token"
												maxlength="200" data-validation-rule="{required:true}"
												data-validation-message="{required:'docker-password를 입력해주세요.'}" />
												<p class="info-text" data-for="pHipchat_auth_token"></p></td>
										</tr>
										<tr>
											<th>docker-email</th>
											<td><input class="Textinput Width-100"
												th:id="pHipchat_auth_token" th:name="pHipchat_auth_token"
												maxlength="200" data-validation-rule="{required:true}"
												data-validation-message="{required:'docker-email을 입력해주세요.'}" />
												<p class="info-text" data-for="pHipchat_auth_token"></p></td>
										</tr>
									</tbody>
								</table>
							</fieldset>
						</div>
						<div id="pTLSDiv" style="display: none;">
							<fieldset>
								<table class="Table Form-type channel-line">
									<colgroup>
										<col style="width: 180px;" />
										<col />
									</colgroup>
									<tbody>
										<tr>
											<th class="Valign-top">certificate</th>
											<td><input type="file" id="certificate" name="certificate" /></td>
										</tr>
										<tr>
											<th class="Valign-top">key</th>
											<td><input type="file" id="key" name="key" /></td>
										</tr>
									</tbody>
								</table>
							</fieldset>
						</div>
					</form>
				</fieldset>
			</div>
		</div>
		<!--button-->
		<div class="popup-btn__wrap" style="background: #ffffff;">
			<button class="Button btn bg-red" id="popOk">확인</button>
			<button class="Button btn" id="popCancel">취소</button>
		</div>
		<!--//button-->
	</div>
</body>
</html>