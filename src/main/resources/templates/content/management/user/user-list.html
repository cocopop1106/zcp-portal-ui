<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3" layout:decorator="layout/template-default">
    <head>
        <title>사용자 목록</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        
        <script type="text/javascript">
            var zcpPortalApp = {
                pageInit: function() {
                    'use strict';
                    
                    // data init
                    this.grid.init();
                    
                    // data init
                    this.data.init();
                    
                    // event init
                    this.event.init();
                },
                
                grid: {
                	init: function() {
                		$("#user-grid").removeAlopexGrid();
                        $('#user-grid').alopexGrid({ 
                            pager: true,
                            paging: {
                                perPage: 10,
                                pagerCount: 10,
                                pagerSelect: true,
                                pagerTotal: true
                            },
                            defaultSorting:{
                                sortingColumn: 'createdDate',
                                sortingDirection: 'desc'
                            },
                            defaultColumnMapping : {
                                sorting: true,
                                resizing : true
                            },
                            message: {
                                nodata: '등록된 사용자가 없습니다.'
                            },
                            autoColumnIndex: true,
                            columnMapping: [
                                {
                                    key: 'username',
                                    title: '아이디',
                                    width: '80px',
                                    align: 'left',
                                    render: function(value, data) {
                                        return '<a href="javascript:zcpPortalApp.data.userDetail(\'' + data.id + '\');" >' + data.username + '</a>';
                                    }
                                }, 
                                {
                                    key: 'email',
                                    title: '이메일',
                                    width: '120px',
                                    align : 'left'
                                },
                                {
                                    key: 'firstName',
                                    title: '이름',
                                    width: '80px',
                                    align : 'left'
                                },
                                {
                                    key: 'clusterRole',
                                    title: 'Cluster 권한',
                                    width: '80px',
                                    align: 'center',
                                    render: function (value, data) {
                                        if (data.clusterRole) {
                                            return data.clusterRole;
                                        } else {
                                            return 'none';
                                        }
                                    }
                                },
                                {
                                    key: 'usedNamespace',
                                    title: '사용 Namespace',
                                    width: '80px',
                                    align: 'center'
                                },
                                {
                                    key: 'createdDate',
                                    title: '생성일시',
                                    width: '100px',
                                    align: 'center'
                                },
                                {
                                    key: 'enabled',
                                    title: '상태',
                                    width: '50px',
                                    align: 'center',
                                    render: function (value, data) {
                                        if (data.enabled) {
                                            return 'active';
                                        } else {
                                            return 'inactive';
                                        }
                                    }
                                },
                                {
                                    key: 'delete',
                                    title: '관리',
                                    width: '40px',
                                    align: 'center',
                                    sorting: false,
                                    render: function(value, data) {
                                        return '<button class="btn-ico del" onclick="zcpPortalApp.data.userDelete(\'' + data.id + '\');" />';
                                    }
                                },
                                {
                                    key: 'id',
                                    title: '아이디',
                                    hidden: true
                                }
                            ],
                        });
                	},
                	
                	search: function() {
                		var keyword = $('#keyword').val();
                        
                		zcpPortalApp.data.getUsers(keyword);
                    }
                },
                
                data: {
                    init: function() {
                        this.getUsers();
                    },
                    getUsers: function(keyword) {
                    	var data = {
                    		keyword: keyword || ''	
                    	}
                    	
                    	$a.request('/management/user/getUsers', {
                            method: 'post',
                            data: data, 
                            success: function(res) {
                                $('#user-grid').alopexGrid('dataSet', res);
                            },
                            error: function(errObject) {
                                //alert('처리 중 오류가 발생하였습니다. 잠시 후 다시 시도하세요.');
                            }
                        })
                    },
                    userDelete: function(id) {
                    	var data = {
                    		id: id	
                    	};
                        
                        if (!confirm('사용자를 삭제하시겠습니까?')) return false;
                        
                        $a.request('/management/user/deleteUser', {
                            method: 'post',
                            data: data, 
                            success : function(res) {
                                alert('정상처리 되었습니다.');
                                location.reload();
                            },
                            error : function(errObject) {
                                //alert('처리 중 오류가 발생하였습니다. 잠시 후 다시 시도하세요.');
                            }
                        })
                    },
                    userDetail: function(id) {
                    	location.href = '/management/user/' + id;
                    }
                },
                event: {
                    init: function() {
                    	$('#btnSearch').on('click', function() {
                    		zcpPortalApp.grid.search();
                        });
                    	
                    	$('#keyword').on('keydown', function(e) {
                            if (e.keyCode === 13) {
                            	zcpPortalApp.grid.search();
                            }
                        });
                    	
                    	$('#btnAdd').on('click', function() {
                            location.href = '/management/user/create';
                        });
                    }
                }
            }
            
            $.alopex.page(function() {
                this.init = function(id, param) { 
                    zcpPortalApp.pageInit();
                };
            });
        </script>
        
    </head>
    <body>
        <th:block layout:fragment="content">
            <div class="locations-area"></div>
            <div class="contents-box">
                <!-- service top area-->
                <div class="top-area">
                    <h2 class="title">사용자</h2>
                    <div class="tag-wrap">
                        <span class="tag">Container Platform의 사용자 목록 관리 입니다.</span>
                    </div>
                    <div class="btn-wrap__right">
                        <button class="Button btn-ico__typeb btn-adduser" id="btnAdd">사용자추가</button>
                        <div class="Tooltip" data-position="left">사용자추가</div>
                    </div>
                </div>
                <!-- search-wrap-->
                <div class="search-wrap">
                    <input type="text" name="keyword" id="keyword" class="Textinput srcinput" placeholder="검색어를 입력하세요." /><button class="Button btn-search" id="btnSearch">검색</button>
                </div>
                <div class="grid-line__wrap">
                    <div id="user-grid"></div>
                </div>
            </div>
        </th:block>
    </body>
</html>